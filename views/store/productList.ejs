<%- include('../partials/header', { title: 'Products' }) %>

<main class="max-w-6xl mx-auto p-3">

    <!-- TITLE + SEARCH -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
        <h2 class="text-xl font-semibold">Our Products</h2>

        <div class="relative w-full sm:w-72">
            <input type="text" id="searchInput"
                placeholder="Search products..."
                onkeyup="searchProducts()"
                class="w-full pl-10 pr-3 py-2 border rounded-lg
                       focus:outline-none focus:ring-2 focus:ring-blue-400" />
            <span class="absolute left-3 top-2.5 text-gray-400">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2"
                     viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.3-4.3"/>
                </svg>
            </span>
        </div>
    </div>

    <!-- CATEGORY AUTO SCROLL -->
    <div class="relative mt-2">
        <div class="fade-left"></div>
        <div class="fade-right"></div>

        <div id="categoryScroller"
            class="flex gap-3 overflow-x-auto pb-3 scrollbar-hide select-none">

            <button class="category-btn active">All</button>
            <button class="category-btn">Vegetables</button>
            <button class="category-btn">Dairy</button>
            <button class="category-btn">Bakery</button>
            <button class="category-btn">Snacks</button>
            <button class="category-btn">Dal</button>
            <button class="category-btn">Chawal</button>
            <button class="category-btn">Aata</button>

        </div>
    </div>

    <!-- PRODUCTS GRID -->
    <div id="productGrid"
        class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-4">

        <% products.forEach(p => { %>
        <div class="product-card bg-white rounded-xl shadow relative overflow-hidden">

            <!-- Favourite -->
            <form action="/favouriteList" method="POST">
                <button type="submit"
                    class="absolute top-2 right-2 bg-white p-1 rounded-full shadow text-lg">
                    ü§ç
                </button>
                <input type="hidden" name="id" value="<%= p.productId %>">
            </form>

            <!-- Image -->
            <img src="<%= p.imageUrl %>"
                 class="w-full h-32 object-cover" />

            <!-- Content -->
            <div class="p-3 space-y-2">

                <p class="product-name text-sm font-semibold truncate">
                    <%= p.productName %>
                </p>

                <span class="text-green-600 font-bold text-sm">
                    ‚Çπ <%= p.price %>
                </span>

                <!-- ACTION BUTTONS -->
                <div class="flex items-center justify-between gap-2">

    <!-- DETAILS BUTTON -->
    <a href="/products/<%= p._id %>"
       class="flex items-center justify-center gap-1
              bg-blue-500 text-white text-sm
              px-4 py-2 rounded-lg
              hover:bg-blue-600 transition w-full">

        <svg class="w-4 h-4" fill="none" stroke="currentColor"
             stroke-width="2" viewBox="0 0 24 24">
            <path d="M12 5v14M5 12h14"/>
        </svg>
        Details
    </a>

    <!-- ADD TO CART BUTTON -->
    <form action="/myOrders" method="POST" class="w-full">
        <input type="hidden" name="id" value="<%= p.productId %>">

        <button type="submit"
            class="flex items-center justify-center gap-2
                   bg-orange-500 text-white text-sm
                   px-4 py-2 rounded-lg
                   hover:bg-orange-600 transition w-full">

            <svg xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4"
                fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3 3h2l.4 2M7 13h10l4-8H5.4" />
            </svg>

            Add
        </button>
    </form>

</div>

            </div>
        </div>
        <% }) %>

    </div>
</main>

<!-- STYLES -->
<style>
.scrollbar-hide::-webkit-scrollbar{display:none;}
.scrollbar-hide{scrollbar-width:none;}

.category-btn{
    flex-shrink:0;
    padding:8px 18px;
    border-radius:999px;
    border:1px solid #e5e7eb;
    background:white;
    font-size:14px;
    transition:.3s;
}
.category-btn.active{
    background:black;
    color:white;
    transform:scale(1.08);
}
.category-btn:hover{transform:scale(1.05);}

.fade-left,.fade-right{
    position:absolute;
    top:0;
    width:40px;
    height:100%;
    z-index:10;
    pointer-events:none;
}
.fade-left{
    left:0;
    background:linear-gradient(to right, white, transparent);
}
.fade-right{
    right:0;
    background:linear-gradient(to left, white, transparent);
}
</style>

<!-- SCRIPTS -->
<script>
function searchProducts(){
    const v = searchInput.value.toLowerCase();
    document.querySelectorAll('.product-card').forEach(c=>{
        const n = c.querySelector('.product-name').innerText.toLowerCase();
        c.style.display = n.includes(v) ? 'block' : 'none';
    });
}

/* AUTO SCROLL */
const scroller = document.getElementById('categoryScroller');
let interacting=false;

[...scroller.children].forEach(el=>{
    scroller.appendChild(el.cloneNode(true));
});

setInterval(()=>{
    if(!interacting){
        scroller.scrollLeft += 0.4;
        if(scroller.scrollLeft >= scroller.scrollWidth/2){
            scroller.scrollLeft = 0;
        }
    }
},16);

['mousedown','touchstart'].forEach(e=>scroller.addEventListener(e,()=>interacting=true));
['mouseup','touchend'].forEach(e=>scroller.addEventListener(e,()=>interacting=false));

document.querySelectorAll('.category-btn').forEach(btn=>{
    btn.onclick=()=>{
        document.querySelectorAll('.category-btn')
            .forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
    }
});
</script>

<%- include('../partials/footer') %>
